<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>José Rizal — Europe Timeline (1882–1892)</title>
  <style>
    /* Brown + dark theme variables */
    :root{
      --bg:#1b1410; /* deep espresso */
      --panel:#291e18; /* dark brown panel */
      --muted:#7a5844; /* muted brown */
      --accent:#c79a6b; /* warm tan */
      --accent-2:#b06f3a; /* burnt sienna */
      --text:#f4efe6;
      --glass: rgba(255,255,255,0.04);
      --map-grid: rgba(255,255,255,0.02);
      --node-size: 18px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#0f0b09);color:var(--text)}

    /* page layout */
    .wrap{max-width:1200px;margin:32px auto;padding:28px;display:grid;grid-template-columns:320px 1fr;gap:24px}

    header.card{background:linear-gradient(180deg,var(--panel), rgba(255,255,255,0.02));border-radius:14px;padding:20px;box-shadow:0 8px 30px rgba(0,0,0,0.6);backdrop-filter: blur(6px)}
    header h1{margin:0;font-size:20px;letter-spacing:0.3px}
    header p{color:var(--muted);margin-top:8px;font-size:13px;line-height:1.4}

    /* map-area */
    .map-area{position:relative;background-image:
      radial-gradient(circle at 15% 20%, rgba(255,255,255,0.02) 0 1px, transparent 2px),
      linear-gradient(90deg, rgba(255,255,255,0.01) 1px, transparent 1px),
      linear-gradient(180deg, rgba(255,255,255,0.01) 1px, transparent 1px);
    background-size: 120px 120px, 30px 30px, 30px 30px;
    border-radius:14px;padding:18px;min-height:720px;overflow:auto; /* Changed overflow to auto */ }

    /* subtle map texture */
    .map-area:after{content:"";position:absolute;inset:0;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><path d="M10 300 C 150 120, 350 120, 490 300 S 830 480, 990 300" stroke="%23ffffff" stroke-opacity="0.02" fill="none" stroke-width="1"/></svg>');mix-blend-mode:overlay;opacity:0.6;pointer-events:none;}

    /* timeline center line like a travel route */
    .route{position:absolute;left:50%;top:20px;bottom:20px;width:4px;margin-left:-2px;background:linear-gradient(#5c432d,#2b1b14);border-radius:6px;box-shadow:0 0 20px rgba(0,0,0,0.6)}

    /* nodes */
    .node{position:absolute;transform:translateX(-50%);width:360px;padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));box-shadow:0 10px 30px rgba(0,0,0,0.6);cursor:pointer;transition:transform .36s cubic-bezier(.22,.9,.3,1), box-shadow .25s}
    .node:hover{transform:translateX(-50%) translateY(-6px) scale(1.02);box-shadow:0 20px 50px rgba(0,0,0,0.6)}

    .node .pin{position:absolute;left:-56px;top:14px;width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:var(--accent);box-shadow:0 6px 18px rgba(176,111,58,0.25);font-weight:700}
    .node .date{font-size:12px;color:var(--muted);margin-bottom:8px}
    .node h3{margin:0;font-size:16px}
    .node p{margin:8px 0 0;font-size:14px;color:var(--text);line-height:1.35}
    .node .sources{margin-top:10px;font-size:12px;color:var(--muted)}

    /* left/right positioning (FIXED) */
    .node.left{left:38%}
    .node.right{left:62%}

    /* small map pins on center route */
    .route-pin{position:absolute;left:50%;width:var(--node-size);height:var(--node-size);margin-left:calc(var(--node-size) / -2);border-radius:50%;background:var(--accent-2);box-shadow:0 6px 14px rgba(176,111,58,0.25);display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;cursor:pointer;}

    /* details panel */
    .details{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:12px;height:720px;overflow:auto}
    .details h2{margin-top:0}
    .meta{color:var(--muted);font-size:13px}
    .controls{display:flex;gap:8px;margin:12px 0}
    .btn{background:var(--glass);border:1px solid rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px;color:var(--text);cursor:pointer}
    .btn.active{background:linear-gradient(90deg,var(--accent) 0%, var(--accent-2) 100%);color:#2b1b14;font-weight:600;border:none}

    /* small responsiveness */
    @media (max-width:900px){.wrap{grid-template-columns:1fr;padding:18px}.map-area{min-height:880px}.node{width:86%;left:50%}.node.left,.node.right{left:50%;transform:translateX(-50%)}}

    /* subtle entrance animations */
    .node{opacity:0;transform-origin:center;animation:pop .7s forwards}
    @keyframes pop{from{opacity:0;transform:translateX(-50%) translateY(12px) scale(.98)}to{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}}

    footer{grid-column:1 / -1;color:var(--muted);font-size:13px;text-align:center;margin-top:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <header class="card">
      <h1>José Rizal — Europe Timeline (1882–1892)</h1>
      <p>A map-style, interactive timeline following Rizal's ten years in Europe. Click any pin on the route to read dates, places, and excerpts. Nodes include sources and micro-stories.</p>
      <div style="margin-top:12px" class="meta">Theme: brown / dark • Interactive nodes • Smooth transitions</div>
      <div style="margin-top:14px" class="controls">
        <button class="btn" id="first">First</button>
        <button class="btn" id="prev">‹ Prev</button>
        <button class="btn" id="next">Next ›</button>
        <button class="btn" id="last">Last</button>
        <button class="btn" id="toggle-sources">Toggle sources</button>
      </div>
      <div style="margin-top:10px;color:var(--muted);font-size:13px">Tip: use arrow keys ← → to move between events</div>
    </header>

    <main class="map-area" id="map">
      <div class="route" aria-hidden="true"></div>
      <div class="details" id="details">
        <h2 id="d-title">Select an event</h2>
        <div class="meta" id="d-sub"></div>
        <p id="d-body" style="margin-top:10px;color:var(--text);line-height:1.45">Click any pin on the central route to view the details here. The timeline covers Rizal's studies, publications, travels, and key milestones between 1882 and 1892.</p>
        <div id="d-sources" style="margin-top:12px;color:var(--muted);font-size:13px"></div>
      </div>
    </main>

    <footer>Built with ❤️ • Timeline data: travels-of-rizal.weebly.com, philembassymadrid.com, knightsofrizal.be</footer>
  </div>

  <script>
    const events = [
      { id:1, year:1882, date:'May 3, 1882', place:'Left Manila (Salvadora)', title:'Departure from Manila', summary:'Left Manila aboard the Salvadora without informing Spanish authorities to avoid being blocked.', details:'Rizal departed secretly on May 3, 1882, bound for Spain. His departure marked the beginning of his decade-long European journey focused on education, medical specialization, and reform writing.', sources:['https://travels-of-rizal.weebly.com/','https://philembassymadrid.com/rizals-madrid'] },
      { id:2, year:1882, date:'June 15, 1882', place:'Barcelona → Madrid', title:'Arrival in Barcelona; Amor Patrio', summary:'Arrived in Barcelona; wrote "Amor Patrio", first article published in Diariong Tagalog.', details:'On June 15 Rizal reached Barcelona and soon after moved to Madrid where he enrolled at Universidad Central. He wrote the patriotic essay "Amor Patrio" and began connecting with Filipino reformists.', sources:['https://travels-of-rizal.weebly.com/'] },
      { id:3, year:1883, date:'1883', place:'Madrid', title:'Student life in Madrid', summary:'Continued studies; wrote poetry, learned French, started short travels.', details:'Rizal studied medicine and philosophy and letters, wrote essays and poems, and expanded his language skills — including French — taking short trips during breaks to Paris.', sources:['https://travels-of-rizal.weebly.com/'] },
      { id:4, year:1884, date:'1884', place:'Madrid', title:'Academic success & social life', summary:'Finished Licentiate in Medicine; socialized with Filipino reformists; financial struggles.', details:'By 1884 Rizal had completed his licentiate and participated in the Filipino intellectual scene in Madrid — toasting fellow artists like Juan Luna — while often relying on loans to survive.', sources:['https://knightsofrizal.be/'] },
      { id:5, year:1885, date:'1885', place:'Paris', title:'Decision to specialize (Ophthalmology)', summary:'Finished Licentiate in Philosophy and Letters; chose ophthalmology for his mother’s sake; prepared for studies in Paris and Germany.', details:'Rizal decided to specialize in ophthalmology after completing studies in Madrid, planning advanced studies in Paris and Germany to treat his mother’s eye condition.', sources:['https://travels-of-rizal.weebly.com/'] },
      { id:6, year:1885, date:'1885–1886', place:'Paris', title:'Training under Dr. de Wecker', summary:'Worked under Dr. Louis de Wecker; learned surgical techniques; faced financial hardship.', details:'While in Paris Rizal trained with the famous oculist Louis de Wecker. Life in Paris was expensive and he often endured hardship while studying museums and libraries to broaden his cultural knowledge.', sources:['https://travels-of-rizal.weebly.com/'] },
      { id:7, year:1886, date:'1886', place:'Heidelberg', title:'Heidelberg — study with Dr. Otto Becker', summary:'Studied at Heidelberg\'s University Eye Hospital; wrote "A Las Flores de Heidelberg".', details:'Rizal studied ophthalmology under Dr. Otto Becker in Heidelberg, trained with microscopes and wrote the poem "A Las Flores de Heidelberg" reflecting his homesickness.', sources:['https://knightsofrizal.be/'] },
      { id:8, year:1886, date:'Late 1886', place:'Leipzig', title:'Leipzig — philosophy & translations', summary:'Attended philosophy and history lectures; translated German works into Tagalog.', details:'In Leipzig Rizal deepened his philosophical education, translated German texts into Tagalog, and admired the German educational system.', sources:['https://knightsofrizal.be/'] },
      { id:9, year:1886, date:'1886–1887', place:'Berlin', title:'Berlin — research & Noli Me Tangere', summary:'Joined scholarly societies; published "Noli Me Tangere" (Mar 1887).', details:'Rizal joined Berlin\'s Anthropological and Ethnological societies and completed his first novel "Noli Me Tangere" (published March 1887), which exposed abuses in the colony.', sources:['https://travels-of-rizal.weebly.com/','https://knightsofrizal.be/'] },
      { id:10, year:1888, date:'May 1888', place:'London', title:'London — British Museum research', summary:'Researched Antonio de Morga at the British Museum; contributed to La Solidaridad.', details:'In London Rizal studied at the British Museum and published essays in La Solidaridad while living briefly with the Beckett family.', sources:['https://knightsofrizal.be/'] },
      { id:11, year:1889, date:'1889–1890', place:'Paris & Brussels', title:'Paris & Brussels — El Filibusterismo (begin)', summary:'Returned to Paris then Brussels; began the darker sequel El Filibusterismo.', details:'Rizal moved between Paris and Brussels, developing his second novel and continuing his reformist writings for La Solidaridad.', sources:['https://travels-of-rizal.weebly.com/'] },
      { id:12, year:1891, date:'Sept 1891', place:'Ghent', title:'Ghent — El Filibusterismo published', summary:'Moved to Ghent to economize; published El Filibusterismo in September 1891.', details:'Rizal relocated to Ghent to reduce costs and completed and published El Filibusterismo in September 1891. He dedicated the book to GomBurZa.', sources:['https://knightsofrizal.be/'] },
      { id:13, year:1891, date:'Oct–Nov 1891', place:'Departure to Hong Kong', title:'Leaving Europe (to Hong Kong)', summary:'Left Europe for Hong Kong where he opened a clinic and reunited with family.', details:'In late 1891 Rizal left Europe for Hong Kong, starting a new chapter by opening a medical clinic and continuing his reformist activities in Asia.', sources:['https://travels-of-rizal.weebly.com/'] }
    ];

    const map = document.getElementById('map');
    const dTitle = document.getElementById('d-title');
    const dSub = document.getElementById('d-sub');
    const dBody = document.getElementById('d-body');
    const dSources = document.getElementById('d-sources');

    let showSources = true;
    let currentIndex = 0;

    function createNode(ev, idx, total){
      const wrap = document.createElement('div');
      wrap.className = 'node ' + (idx % 2 === 0 ? 'left' : 'right');
      const t = 8 + (idx/(total-1))*84;
      wrap.style.top = t + '%';
      wrap.style.animationDelay = `${idx * 80}ms`;

      wrap.innerHTML = `
        <div class="pin">${ev.year}</div>
        <div class="date">${ev.date} • ${ev.place}</div>
        <h3>${ev.title}</h3>
        <p>${ev.summary}</p>
        <div class="sources" style="display:${showSources ? 'block':'none'}">Sources: ${ev.sources.map(s=>`<a href="${s}" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:underline">${shortDomain(s)}</a>`).join(' • ')}</div>
      `;

      const centerPin = document.createElement('div');
      centerPin.className='route-pin';
      centerPin.style.top = `calc(${t}% + 18px)`; // Adjusted pin position
      centerPin.dataset.index = idx;
      centerPin.title = ev.title;

      wrap.addEventListener('click', ()=> selectEvent(idx));
      centerPin.addEventListener('click', ()=> selectEvent(idx));

      map.appendChild(wrap);
      map.appendChild(centerPin);
    }

    function shortDomain(url){try{const u=new URL(url);return u.hostname.replace('www.','')}catch(e){return url}}

    events.forEach((e,i)=>createNode(e,i,events.length));

    function selectEvent(i){
      const ev = events[i];
      if(!ev) return;
      currentIndex = i;

      dTitle.textContent = ev.title;
      dSub.textContent = `${ev.date} • ${ev.place}`;
      dBody.textContent = ev.details;
      dSources.innerHTML = showSources ? `Sources: ${ev.sources.map(s=>`<a href="${s}" target="_blank" rel="noopener" style="color:var(--accent);text-decoration:underline">${s}</a>`).join('<br>')}` : '';

      document.querySelectorAll('.route-pin').forEach((p, p_idx) => {
        p.style.transform = (p_idx === i) ? 'scale(1.3)' : 'scale(1)';
        p.style.background = (p_idx === i) ? 'var(--accent)' : 'var(--accent-2)';
      });

      const currentPin = document.querySelector(`.route-pin[data-index='${i}']`);
      if(currentPin){
          const rect = currentPin.getBoundingClientRect();
          const mapRect = map.getBoundingClientRect();
          const offset = rect.top - mapRect.top - (mapRect.height/2) + (rect.height/2);
          map.scrollTo({top: map.scrollTop + offset, behavior:'smooth'});
      }
    }

    document.getElementById('next').addEventListener('click', ()=> selectEvent(Math.min(events.length-1, currentIndex+1)));
    document.getElementById('prev').addEventListener('click', ()=> selectEvent(Math.max(0, currentIndex-1)));
    document.getElementById('first').addEventListener('click', ()=> selectEvent(0));
    document.getElementById('last').addEventListener('click', ()=> selectEvent(events.length-1));

    // CORRECTED: Toggle sources logic
    document.getElementById('toggle-sources').addEventListener('click', (e)=>{
      showSources = !showSources;
      document.querySelectorAll('.node .sources').forEach(el=> el.style.display = showSources ? 'block' : 'none');
      e.currentTarget.classList.toggle('active', showSources);
      // Re-render the details panel to reflect the change
      selectEvent(currentIndex);
    });

    window.addEventListener('keydown', (ev)=>{
      if(ev.key === 'ArrowRight') document.getElementById('next').click();
      if(ev.key === 'ArrowLeft') document.getElementById('prev').click();
    });
    
    // CORRECTED: Set initial state for toggle button
    document.getElementById('toggle-sources').classList.toggle('active', showSources);
    selectEvent(0);

    document.querySelectorAll('.route-pin').forEach((pin, i)=>{pin.tabIndex = 0; pin.addEventListener('keydown', (e)=>{ if(e.key === 'Enter') selectEvent(i) })});

    function adaptDetails(){
      const detailsEl = document.getElementById('details');
      if(window.innerWidth < 900){ detailsEl.style.height = '360px'; }
      else detailsEl.style.height = '720px';
    }
    window.addEventListener('resize', adaptDetails);
    adaptDetails();

  </script>
</body>
</html>
